(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{141:function(e){e.exports=[{constant:!0,inputs:[{name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"tokenId",type:"uint256"}],name:"getApproved",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"to",type:"address"},{name:"tokenId",type:"uint256"}],name:"approve",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"tokenId",type:"uint256"}],name:"transferFrom",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"owner",type:"address"},{name:"index",type:"uint256"}],name:"tokenOfOwnerByIndex",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"tokenId",type:"uint256"}],name:"safeTransferFrom",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"index",type:"uint256"}],name:"tokenByIndex",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"tokenId",type:"uint256"}],name:"ownerOf",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"owner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[],name:"symbol",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"to",type:"address"},{name:"approved",type:"bool"}],name:"setApprovalForAll",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"tokenId",type:"uint256"},{name:"_data",type:"bytes"}],name:"safeTransferFrom",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"tokenId",type:"uint256"}],name:"tokenURI",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"owner",type:"address"},{name:"operator",type:"address"}],name:"isApprovedForAll",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"view",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!0,name:"tokenId",type:"uint256"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"approved",type:"address"},{indexed:!0,name:"tokenId",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"operator",type:"address"},{indexed:!1,name:"approved",type:"bool"}],name:"ApprovalForAll",type:"event"}]},142:function(e,t,n){e.exports=n(343)},147:function(e,t,n){},150:function(e,t,n){},182:function(e,t){},184:function(e,t){},209:function(e,t){},225:function(e,t){},227:function(e,t){},258:function(e,t){},343:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),s=n(140),o=n.n(s),c=(n(147),n(19)),i=n(20),u=n(30),l=n(29),d=n(31),p=n(4),m=n.n(p),f=n(15),b=(n(150),n(52)),h=n.n(b);function y(e,t,n){var a;if(window.ethereum)if(a=new h.a(window.ethereum),!0===n)try{window.ethereum.enable().then(function(){return e(a)})}catch(r){console.log(r)}else e(a);else if(window.web3)a=new h.a(window.web3.currentProvider),e(a);else{if(!0===n)throw new Error("Non-Ethereum browser detected. Cannot work in authenticated mode");a=new h.a(t),console.log("Non-Ethereum browser detected. Using ".concat(t,".")),e(a)}}function w(e,t,n){return v.apply(this,arguments)}function v(){return(v=Object(f.a)(m.a.mark(function e(t,n,a){var r,s;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.eth.getCode(n);case 2:return r=e.sent,s=t.eth.abi.encodeFunctionSignature(a),e.abrupt("return",r.indexOf(s.slice(2,s.length))>0);case 5:case"end":return e.stop()}},e)}))).apply(this,arguments)}var k,E=n(71),x=n(16),O=n(40),g=n(8),j={web3:null},I=n(141),T=function(){function e(t){Object(c.a)(this,e),this.web3=j.web3,this.address=t,this.contract=new this.web3.eth.Contract(I,t)}return Object(i.a)(e,[{key:"isEnumerable",value:function(){var e=Object(f.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(this.web3,this.address,"tokenOfOwnerByIndex(address,uint256)");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"name",value:function(){var e=Object(f.a)(m.a.mark(function e(){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.methods.name().call();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"tokensViaEvents",value:function(e){var t=this;return Object(O.a)(m.a.mark(function n(){var a,r,s,o,c,i,u;return m.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(x.a)(t.contract.getPastEvents("Transfer",{fromBlock:0,toBlock:"latest",topics:[Object(g.sha3)("Transfer(address,address,uint256)"),Object(g.padLeft)(e,64),null]}));case 2:return a=n.sent,n.next=5,Object(x.a)(t.contract.getPastEvents("Transfer",{fromBlock:0,toBlock:"latest",topics:[Object(g.sha3)("Transfer(address,address,uint256)"),null,Object(g.padLeft)(e,64)]}));case 5:for(r=n.sent,s=0;s<a.length;s++)for(o=a[s].returnValues.tokenId,c=0;c<r.length;c++)i=r[c].returnValues.tokenId,o===i&&r.splice(c,1);u=0;case 8:if(!(u<r.length)){n.next=14;break}return n.next=11,r[u].returnValues.tokenId;case 11:u++,n.next=8;break;case 14:case"end":return n.stop()}},n)}))()}},{key:"tokensViaEnumSync",value:function(e){var t=this;return Object(O.a)(m.a.mark(function n(){var a,r;return m.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(x.a)(t.balanceOf(e));case 2:a=n.sent,r=0;case 4:if(!(r<a)){n.next=10;break}return n.next=7,t.contract.methods.tokenOfOwnerByIndex(e,r).call();case 7:r++,n.next=4;break;case 10:case"end":return n.stop()}},n)}))()}},{key:"tokensViaEnum",value:function(e){var t=this;return Object(O.a)(m.a.mark(function n(){var a,r,s,o,c,i,u;return m.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(x.a)(t.isEnumerable());case 2:if(n.sent){n.next=4;break}throw new Error("contract does't implement ERC721Enumerable");case 4:return j.web3,n.next=7,Object(x.a)(t.balanceOf(e));case 7:for(a=n.sent,r={},s=function(n){r[n]=new Promise(function(a,r){return t.contract.methods.tokenOfOwnerByIndex(e,n).call().then(function(e){return a([n,e])})})},o=0;o<a;o++)s(o);case 11:if(!Object.values(r).length){n.next=23;break}return n.next=14,Object(x.a)(Promise.race(Object.values(r)));case 14:return c=n.sent,i=Object(E.a)(c,2),o=i[0],u=i[1],delete r[o],n.next=21,u;case 21:n.next=11;break;case 23:case"end":return n.stop()}},n)}))()}},{key:"tokensViaEnumBatch",value:function(e){var t=this;return Object(O.a)(m.a.mark(function n(){var a,r,s,o,c,i,u,l,d;return m.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(x.a)(t.isEnumerable());case 2:if(n.sent){n.next=4;break}throw new Error("contract does't implement ERC721Enumerable");case 4:return a=j.web3,n.next=7,Object(x.a)(t.balanceOf(e));case 7:for(r=n.sent,s={},o=new a.BatchRequest,c=function(n){s[n]=new Promise(function(a,r){return o.add(t.contract.methods.tokenOfOwnerByIndex(e,n).call.request({from:e},function(e,t){return a([n,t])}))})},i=0;i<r;i++)c(i);o.execute();case 13:if(!Object.values(s).length){n.next=25;break}return n.next=16,Object(x.a)(Promise.race(Object.values(s)));case 16:return u=n.sent,l=Object(E.a)(u,2),i=l[0],d=l[1],delete s[i],n.next=23,d;case 23:n.next=13;break;case 25:case"end":return n.stop()}},n)}))()}},{key:"balanceOf",value:function(){var e=Object(f.a)(m.a.mark(function e(t){return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.contract.methods.balanceOf(t).call();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}]),e}(),S=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={fetching:!1,startTime:0,stopTime:0,tokens:[]},n}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentWillUnmount",value:function(){clearInterval(this.intervalId)}},{key:"componentDidUpdate",value:function(e){this.props.contract===e.contract&&this.props.owner===e.owner||(console.log("clear interval"),this.setState({fetching:!1,startTime:0,stopTime:0,tokens:[]}),clearInterval(this.intervalId))}},{key:"fetchTokens",value:function(){var e=Object(f.a)(m.a.mark(function e(){var t,n,a,r,s,o,c,i,u,l=this;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.props,n=t.strategy,a=t.contract,r=t.owner,t.disabled,s=new T(a),this.setState({fetching:!0,startTime:new Date,stopTime:new Date,tokens:[]}),this.intervalId=setInterval(function(){return l.setState({stopTime:new Date})},1e3),o=[],c=s[n](r);case 6:return e.prev=7,e.next=10,c.next();case 10:if(i=e.sent,u=i.value,!i.done){e.next=15;break}return e.abrupt("break",25);case 15:o.push(u),e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(7),this.setState({error:e.t0.toString().split("\n")[0]}),e.abrupt("return");case 22:this.setState({tokens:o}),e.next=6;break;case 25:clearInterval(this.intervalId),this.setState({tokens:o,fetching:!1,stopTime:new Date});case 27:case"end":return e.stop()}},e,this,[[7,18]])}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.error,n=e.tokens,a=e.startTime,s=e.stopTime,o=(e.fetching,this.props),c=o.strategy,i=o.disabled;return r.a.createElement("div",{className:"Query"},r.a.createElement("h3",null,"Fetch strategy: ",r.a.createElement("code",null,c)),r.a.createElement("div",null,"Found ",n.length," tokens: ",n.join(", ")),t?r.a.createElement("div",null,t):r.a.createElement("div",null,r.a.createElement("div",null,"Elapsed Time (s): ",(s-a)/1e3),r.a.createElement("button",{onClick:this.fetchTokens.bind(this),disabled:i},"Fetch")))}}]),t}(a.Component),C=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e))).state={contract:"0x6EbeAf8e8E946F0716E6533A6f2cefc83f60e8Ab",owner:"0x4eb5c09f266a6681f3a7729cd4587cbb1ae3d41e"},n}return Object(d.a)(t,e),Object(i.a)(t,[{key:"handleSubmit",value:function(){var e=Object(f.a)(m.a.mark(function e(t){var n,a,r;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),j.web3,this.setState({fetching:!0,balance:null,name:null}),n=t.target.contract.value,a=t.target.owner.value,r=new T(n),e.t0=this,e.next=9,r.balanceOf(a);case 9:return e.t1=e.sent.toString(10),e.next=12,r.name();case 12:e.t2=e.sent,e.t3={balance:e.t1,name:e.t2,fetching:!1},e.t0.setState.call(e.t0,e.t3);case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state||{},n=t.balance,a=t.name,s=t.fetching,o=t.contract,c=t.owner;return r.a.createElement("div",{className:"Benchmark"},r.a.createElement("h1",null,"Step 1: Load a Smart Contract"),"Select one example from below:",r.a.createElement("ul",null,r.a.createElement("li",{onClick:function(){return e.setState({contract:"0x6EbeAf8e8E946F0716E6533A6f2cefc83f60e8Ab",owner:"0x4eb5c09f266a6681f3a7729cd4587cbb1ae3d41e"})}},"Gods Unchained"),r.a.createElement("li",{onClick:function(){return e.setState({contract:"0x8bc67d00253fd60b1afcce88b78820413139f4c6",owner:"0xfc7a64183f49f71a1d604496e62c08f20af5b5d6"})}},"CryptoFlowers"),r.a.createElement("li",{onClick:function(){return e.setState({contract:"0xBd13e53255eF917DA7557db1B7D2d5C38a2EFe24",owner:"0xf862c9413f2cc21ebfda534ecfa6df4f59f0b197"})}},"DozerDoll"),r.a.createElement("li",{onClick:function(){return e.setState({contract:"0x06012c8cf97bead5deae237070f9587f8e7a266d",owner:"0x491fd53e5e0d8b4a5f28d008856060cda5380aaf"})}},"CryptoKitties (doesn't work, requires a dedicated API call)")),"Or insert your own custom addresses:",r.a.createElement("form",{onSubmit:this.handleSubmit.bind(this)},r.a.createElement("div",null,"Contract address:"," ",r.a.createElement("input",{name:"contract",value:o,onChange:function(t){return e.setState({contract:t.target.value})},size:"40"})),r.a.createElement("div",null,"Owner address:"," ",r.a.createElement("input",{name:"owner",value:c,onChange:function(t){return e.setState({owner:t.target.value})},size:"40"})),r.a.createElement("input",{type:"submit",disabled:s})),r.a.createElement("div",null,r.a.createElement("h3",null,"Metadata"),r.a.createElement("div",null,"Name: ",a),r.a.createElement("div",null,"Balance: ",n),r.a.createElement("h1",null,"Step 2: Test strategies"),r.a.createElement("p",null,r.a.createElement("em",null,"Note: if you are aware of any caching mechanism that can invalidate those results please tell me.")),r.a.createElement("p",null,"Check the"," ",r.a.createElement("a",{href:"https://github.com/vrde/erc721-benchmark/blob/master/src/ERC721.js"},"source code")," ","of the different functions."),r.a.createElement(S,{strategy:"tokensViaEvents",contract:o,owner:c,disabled:!n}),r.a.createElement(S,{strategy:"tokensViaEnum",contract:o,owner:c,disabled:!n}),r.a.createElement(S,{strategy:"tokensViaEnumBatch",contract:o,owner:c,disabled:!n})))}}]),t}(a.Component),B=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("h1",null,"ERC721 Benchmark"),r.a.createElement("p",null,r.a.createElement("em",null,"Note: there might be some errors not handled yet, please keep the browser debugging console open.")),r.a.createElement("p",null,"Source code on GitHub:"," ",r.a.createElement("a",{href:"https://www.github.com/vrde/erc721-benchmark"},"github.com/vrde/erc721-benchmark"),"."),r.a.createElement("p",null,"The"," ",r.a.createElement("a",{href:"https://eips.ethereum.org/EIPS/eip-721"},"ERC721 standard")," ","interface doesn't expose any method to get the list of token ids owned by a user. A method to query the tokens of a user would result would be too expensive to run on chain(",r.a.createElement("a",{href:"https://github.com/OpenZeppelin/openzeppelin-solidity/issues/1064#issuecomment-462837092"},"comment 1"),","," ",r.a.createElement("a",{href:"https://github.com/OpenZeppelin/openzeppelin-solidity/pull/856#issuecomment-406723880"},"comment 2"),"), and this would result in a security hole. Instead,"," ",r.a.createElement("code",null,"tokensOf")," returns the ",r.a.createElement("strong",null,"total amount")," of tokens owned by a user. The standard enforces to emit a"," ",r.a.createElement("code",null,"Transfer(address indexed _from, address indexed _to, uint256 indexed _tokenId)")," ","every time a token is transferred. Events can be used to get the list of tokens owned by a user. This approach queries the"," ",r.a.createElement("code",null,"Transfer")," events emitted by the smart contract that holds the tokens. As we will see later, quering for events is a slow operation that might fail."),r.a.createElement("p",null,"ERC721 describes an optional enumeration extension to make the list of tokens fully discoverable. The ",r.a.createElement("a",{href:""},"ERC721Enumerable")," ","interface defines a new method"," ",r.a.createElement("code",null,"tokenOfOwnerByIndex(address _owner, uint256 _index)"),". This combined with ",r.a.createElement("code",null,"balanceOf")," allow us to iterate over the tokens of a user to get the token ids. This approach is much faster and reliable."),r.a.createElement("h2",null,"Playground"),r.a.createElement("p",null,"Try the different fetching strategies yourself. Load a smart contract and test the performance.")),r.a.createElement(C,null))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));(function(e,t){return e=e||"https://mainnet.infura.io/",new Promise(function(n){window.addEventListener("load",function(){y(n,e,t)}),"complete"===document.readyState&&y(n,e,t)})})(k,!1).then(function(e){j.web3=e,o.a.render(r.a.createElement(B,null),document.getElementById("root"))}),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[142,1,2]]]);
//# sourceMappingURL=main.8abbff40.chunk.js.map